{"ast":null,"code":"import _taggedTemplateLiteral from\"C:/Dokumente/GitHub/smurf/SMURF-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import _regeneratorRuntime from\"C:/Dokumente/GitHub/smurf/SMURF-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Dokumente/GitHub/smurf/SMURF-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Dokumente/GitHub/smurf/SMURF-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5;import BigNumber from'bignumber.js';import React,{useCallback,useState}from'react';import styled from'styled-components';import{Button,IconButton,useModal,AddIcon,Image}from'@blzd-dev/uikit';import{useWallet}from'@binance-chain/bsc-use-wallet';import UnlockButton from'components/UnlockButton';import Label from'components/Label';import{useERC20}from'hooks/useContract';import{useSousApprove}from'hooks/useApprove';import useI18n from'hooks/useI18n';import{useSousStake}from'hooks/useStake';import{useSousUnstake}from'hooks/useUnstake';import{getBalanceNumber}from'utils/formatBalance';import{getPoolApy}from'utils/apy';import{getAddress}from'utils/addressHelpers';import{useSousHarvest}from'hooks/useHarvest';import Balance from'components/Balance';import{PoolCategory}from'config/constants/types';import tokens from'config/constants/tokens';import{useGetApiPrice}from'state/hooks';import DepositModal from'./DepositModal';import WithdrawModal from'./WithdrawModal';import CompoundModal from'./CompoundModal';import CardTitle from'./CardTitle';import Card from'./Card';import OldSyrupTitle from'./OldSyrupTitle';import HarvestButton from'./HarvestButton';import CardFooter from'./CardFooter';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var PoolCard=function PoolCard(_ref){var pool=_ref.pool;var sousId=pool.sousId,stakingToken=pool.stakingToken,earningToken=pool.earningToken,harvest=pool.harvest,poolCategory=pool.poolCategory,totalStaked=pool.totalStaked,startBlock=pool.startBlock,endBlock=pool.endBlock,isFinished=pool.isFinished,userData=pool.userData,stakingLimit=pool.stakingLimit;// Pools using native BNB behave differently than pools using a token\nvar isBnbPool=poolCategory===PoolCategory.BINANCE;var TranslateString=useI18n();var stakingTokenContract=useERC20(stakingToken.address?getAddress(stakingToken.address):'');var _useWallet=useWallet(),account=_useWallet.account;var _useSousApprove=useSousApprove(stakingTokenContract,sousId),onApprove=_useSousApprove.onApprove;var _useSousStake=useSousStake(sousId,isBnbPool),onStake=_useSousStake.onStake;var _useSousUnstake=useSousUnstake(sousId),onUnstake=_useSousUnstake.onUnstake;var _useSousHarvest=useSousHarvest(sousId,isBnbPool),onReward=_useSousHarvest.onReward;// APY\nvar rewardTokenPrice=useGetApiPrice(earningToken.symbol);var stakingTokenPrice=useGetApiPrice(stakingToken.symbol);var apy=getPoolApy(stakingTokenPrice,rewardTokenPrice,getBalanceNumber(pool.totalStaked,stakingToken.decimals),parseFloat(pool.tokenPerBlock));var _useState=useState(false),_useState2=_slicedToArray(_useState,2),requestedApproval=_useState2[0],setRequestedApproval=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),pendingTx=_useState4[0],setPendingTx=_useState4[1];var allowance=new BigNumber((userData===null||userData===void 0?void 0:userData.allowance)||0);var stakingTokenBalance=new BigNumber((userData===null||userData===void 0?void 0:userData.stakingTokenBalance)||0);var stakedBalance=new BigNumber((userData===null||userData===void 0?void 0:userData.stakedBalance)||0);var earnings=new BigNumber((userData===null||userData===void 0?void 0:userData.pendingReward)||0);var isOldSyrup=stakingToken.symbol===tokens.syrup.symbol;var accountHasStakedBalance=(stakedBalance===null||stakedBalance===void 0?void 0:stakedBalance.toNumber())>0;var needsApproval=!accountHasStakedBalance&&!allowance.toNumber()&&!isBnbPool;var isCardActive=isFinished&&accountHasStakedBalance;var convertedLimit=new BigNumber(stakingLimit).multipliedBy(new BigNumber(10).pow(earningToken.decimals));var _useModal=useModal(/*#__PURE__*/_jsx(DepositModal,{max:stakingLimit&&stakingTokenBalance.isGreaterThan(convertedLimit)?convertedLimit:stakingTokenBalance,onConfirm:onStake,tokenName:stakingLimit?\"\".concat(stakingToken.symbol,\" (\").concat(stakingLimit,\" max)\"):stakingToken.symbol// stakingTokenDecimals={stakingToken.decimals}\n})),_useModal2=_slicedToArray(_useModal,1),onPresentDeposit=_useModal2[0];var _useModal3=useModal(/*#__PURE__*/_jsx(CompoundModal,{earnings:earnings,onConfirm:onStake,tokenName:stakingToken.symbol})),_useModal4=_slicedToArray(_useModal3,1),onPresentCompound=_useModal4[0];var poolImage=\"\".concat(pool.earningToken.symbol,\"-\").concat(pool.stakingToken.symbol,\".png\").toLocaleLowerCase();var _useModal5=useModal(/*#__PURE__*/_jsx(WithdrawModal,{max:stakedBalance,onConfirm:onUnstake,tokenName:stakingToken.symbol// stakingTokenDecimals={stakingToken.decimals}\n})),_useModal6=_slicedToArray(_useModal5,1),onPresentWithdraw=_useModal6[0];var handleApprove=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var txHash;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setRequestedApproval(true);_context.next=4;return onApprove();case 4:txHash=_context.sent;// user rejected tx or didn't go thru\nif(!txHash){setRequestedApproval(false);}_context.next=11;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);console.error(_context.t0);case 11:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);})),[onApprove,setRequestedApproval]);return/*#__PURE__*/_jsxs(Card,{isActive:isCardActive,isFinished:isFinished&&sousId!==0,children:[isFinished&&sousId!==0&&/*#__PURE__*/_jsx(PoolFinishedSash,{}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'24px'},children:[/*#__PURE__*/_jsxs(CardTitle,{isFinished:isFinished&&sousId!==0,children:[isOldSyrup&&'[OLD]',\" \",earningToken.symbol,\" \",TranslateString(348,'Pool')]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'8px',display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"div\",{style:{flex:1},children:/*#__PURE__*/_jsx(Image,{src:\"https://raw.githubusercontent.com/octahedron22/smurf-frontend/master/public/images/pools/\".concat(poolImage),alt:earningToken.symbol,width:64,height:64})}),account&&harvest&&!isOldSyrup&&/*#__PURE__*/_jsx(HarvestButton,{disabled:!earnings.toNumber()||pendingTx,text:pendingTx?'Collecting':'Harvest',onClick:/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setPendingTx(true);_context2.next=3;return onReward();case 3:setPendingTx(false);case 4:case\"end\":return _context2.stop();}}},_callee2);}))})]}),!isOldSyrup?/*#__PURE__*/_jsxs(BalanceAndCompound,{children:[/*#__PURE__*/_jsx(Balance,{value:getBalanceNumber(earnings,earningToken.decimals),isDisabled:isFinished}),sousId===0&&account&&harvest&&/*#__PURE__*/_jsx(HarvestButton,{disabled:!earnings.toNumber()||pendingTx,text:pendingTx?TranslateString(999,'Compounding'):TranslateString(704,'Compound'),onClick:onPresentCompound})]}):/*#__PURE__*/_jsx(OldSyrupTitle,{hasBalance:accountHasStakedBalance}),/*#__PURE__*/_jsx(Label,{isFinished:isFinished&&sousId!==0,text:TranslateString(330,\"\".concat(earningToken.symbol,\" earned\"))}),/*#__PURE__*/_jsxs(StyledCardActions,{children:[!account&&/*#__PURE__*/_jsx(UnlockButton,{}),account&&(needsApproval&&!isOldSyrup?/*#__PURE__*/_jsx(\"div\",{style:{flex:1},children:/*#__PURE__*/_jsx(Button,{disabled:isFinished||requestedApproval,onClick:handleApprove,width:\"100%\",children:\"Approve \".concat(stakingToken.symbol)})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{disabled:stakedBalance.eq(new BigNumber(0))||pendingTx,style:{width:'80%'},onClick:isOldSyrup?/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setPendingTx(true);_context3.next=3;return onUnstake('0');case 3:setPendingTx(false);case 4:case\"end\":return _context3.stop();}}},_callee3);})):onPresentWithdraw,children:\"Unstake \".concat(stakingToken.symbol)}),/*#__PURE__*/_jsx(StyledActionSpacer,{}),!isOldSyrup&&/*#__PURE__*/_jsx(IconButton,{style:{width:'20%'},disabled:isFinished&&sousId!==0,onClick:onPresentDeposit,children:/*#__PURE__*/_jsx(AddIcon,{color:\"white\"})})]}))]}),/*#__PURE__*/_jsxs(StyledDetails,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[TranslateString(736,'APR'),\":\"]}),isFinished||isOldSyrup||!apy?'-':/*#__PURE__*/_jsx(Balance,{fontSize:\"14px\",isDisabled:isFinished,value:apy,decimals:2,unit:\"%\"})]}),/*#__PURE__*/_jsxs(StyledDetails,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[TranslateString(384,'Your Stake'),\":\"]}),/*#__PURE__*/_jsx(Balance,{fontSize:\"14px\",isDisabled:isFinished,value:getBalanceNumber(stakedBalance,stakingToken.decimals)})]})]}),/*#__PURE__*/_jsx(CardFooter,{projectLink:earningToken.projectLink,decimals:stakingToken.decimals,totalStaked:totalStaked,startBlock:startBlock,endBlock:endBlock,isFinished:isFinished,poolCategory:poolCategory,tokenName:earningToken.symbol,tokenAddress:earningToken.address?getAddress(earningToken.address):'',tokenDecimals:earningToken.decimals})]});};var PoolFinishedSash=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  background-image: url('https://raw.githubusercontent.com/octahedron22/smurf-frontend/master/public/images/pool-finished-sash.svg');\\n  background-position: top right;\\n  background-repeat: not-repeat;\\n  height: 135px;\\n  position: absolute;\\n  right: -24px;\\n  top: -24px;\\n  width: 135px;\\n\"])));var StyledCardActions=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  margin: 16px 0;\\n  width: 100%;\\n  box-sizing: border-box;\\n\"])));var BalanceAndCompound=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  flex-direction: row;\\n\"])));var StyledActionSpacer=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  height: \",\"px;\\n  width: \",\"px;\\n\"])),function(props){return props.theme.spacing[4];},function(props){return props.theme.spacing[4];});var StyledDetails=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  font-size: 14px;\\n\"])));export default PoolCard;","map":{"version":3,"sources":["C:/Dokumente/GitHub/smurf/SMURF-frontend/src/views/Pools/components/PoolCard.tsx"],"names":["BigNumber","React","useCallback","useState","styled","Button","IconButton","useModal","AddIcon","Image","useWallet","UnlockButton","Label","useERC20","useSousApprove","useI18n","useSousStake","useSousUnstake","getBalanceNumber","getPoolApy","getAddress","useSousHarvest","Balance","PoolCategory","tokens","useGetApiPrice","DepositModal","WithdrawModal","CompoundModal","CardTitle","Card","OldSyrupTitle","HarvestButton","CardFooter","PoolCard","pool","sousId","stakingToken","earningToken","harvest","poolCategory","totalStaked","startBlock","endBlock","isFinished","userData","stakingLimit","isBnbPool","BINANCE","TranslateString","stakingTokenContract","address","account","onApprove","onStake","onUnstake","onReward","rewardTokenPrice","symbol","stakingTokenPrice","apy","decimals","parseFloat","tokenPerBlock","requestedApproval","setRequestedApproval","pendingTx","setPendingTx","allowance","stakingTokenBalance","stakedBalance","earnings","pendingReward","isOldSyrup","syrup","accountHasStakedBalance","toNumber","needsApproval","isCardActive","convertedLimit","multipliedBy","pow","isGreaterThan","onPresentDeposit","onPresentCompound","poolImage","toLocaleLowerCase","onPresentWithdraw","handleApprove","txHash","console","error","padding","marginBottom","display","alignItems","flex","eq","width","projectLink","PoolFinishedSash","div","StyledCardActions","BalanceAndCompound","StyledActionSpacer","props","theme","spacing","StyledDetails"],"mappings":"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","sourcesContent":["import BigNumber from 'bignumber.js'\r\nimport React, { useCallback, useState } from 'react'\r\nimport styled from 'styled-components'\r\nimport { Button, IconButton, useModal, AddIcon, Image } from '@blzd-dev/uikit'\r\nimport { useWallet } from '@binance-chain/bsc-use-wallet'\r\nimport UnlockButton from 'components/UnlockButton'\r\nimport Label from 'components/Label'\r\nimport { useERC20 } from 'hooks/useContract'\r\nimport { useSousApprove } from 'hooks/useApprove'\r\nimport useI18n from 'hooks/useI18n'\r\nimport { useSousStake } from 'hooks/useStake'\r\nimport { useSousUnstake } from 'hooks/useUnstake'\r\nimport { getBalanceNumber } from 'utils/formatBalance'\r\nimport { getPoolApy } from 'utils/apy'\r\nimport { getAddress } from 'utils/addressHelpers'\r\nimport { useSousHarvest } from 'hooks/useHarvest'\r\nimport Balance from 'components/Balance'\r\nimport { PoolCategory } from 'config/constants/types'\r\nimport tokens from 'config/constants/tokens'\r\nimport { Pool } from 'state/types'\r\nimport { useGetApiPrice } from 'state/hooks'\r\nimport DepositModal from './DepositModal'\r\nimport WithdrawModal from './WithdrawModal'\r\nimport CompoundModal from './CompoundModal'\r\nimport CardTitle from './CardTitle'\r\nimport Card from './Card'\r\nimport OldSyrupTitle from './OldSyrupTitle'\r\nimport HarvestButton from './HarvestButton'\r\nimport CardFooter from './CardFooter'\r\n\r\ninterface HarvestProps {\r\n  pool: Pool\r\n}\r\n\r\nconst PoolCard: React.FC<HarvestProps> = ({ pool }) => {\r\n  const {\r\n    sousId,\r\n    stakingToken,\r\n    earningToken,\r\n    harvest,\r\n    poolCategory,\r\n    totalStaked,\r\n    startBlock,\r\n    endBlock,\r\n    isFinished,\r\n    userData,\r\n    stakingLimit,\r\n  } = pool\r\n\r\n  // Pools using native BNB behave differently than pools using a token\r\n  const isBnbPool = poolCategory === PoolCategory.BINANCE\r\n  const TranslateString = useI18n()\r\n  const stakingTokenContract = useERC20(stakingToken.address ? getAddress(stakingToken.address) : '')\r\n  const { account } = useWallet()\r\n  const { onApprove } = useSousApprove(stakingTokenContract, sousId)\r\n  const { onStake } = useSousStake(sousId, isBnbPool)\r\n  const { onUnstake } = useSousUnstake(sousId)\r\n  const { onReward } = useSousHarvest(sousId, isBnbPool)\r\n\r\n  // APY\r\n  const rewardTokenPrice = useGetApiPrice(earningToken.symbol)\r\n  const stakingTokenPrice = useGetApiPrice(stakingToken.symbol)\r\n  const apy = getPoolApy(\r\n    stakingTokenPrice,\r\n    rewardTokenPrice,\r\n    getBalanceNumber(pool.totalStaked, stakingToken.decimals),\r\n    parseFloat(pool.tokenPerBlock),\r\n  )\r\n\r\n  const [requestedApproval, setRequestedApproval] = useState(false)\r\n  const [pendingTx, setPendingTx] = useState(false)\r\n\r\n  const allowance = new BigNumber(userData?.allowance || 0)\r\n  const stakingTokenBalance = new BigNumber(userData?.stakingTokenBalance || 0)\r\n  const stakedBalance = new BigNumber(userData?.stakedBalance || 0)\r\n  const earnings = new BigNumber(userData?.pendingReward || 0)\r\n\r\n  const isOldSyrup = stakingToken.symbol === tokens.syrup.symbol\r\n  const accountHasStakedBalance = stakedBalance?.toNumber() > 0\r\n  const needsApproval = !accountHasStakedBalance && !allowance.toNumber() && !isBnbPool\r\n  const isCardActive = isFinished && accountHasStakedBalance\r\n\r\n  const convertedLimit = new BigNumber(stakingLimit).multipliedBy(new BigNumber(10).pow(earningToken.decimals))\r\n  const [onPresentDeposit] = useModal(\r\n    <DepositModal\r\n      max={stakingLimit && stakingTokenBalance.isGreaterThan(convertedLimit) ? convertedLimit : stakingTokenBalance}\r\n      onConfirm={onStake}\r\n      tokenName={stakingLimit ? `${stakingToken.symbol} (${stakingLimit} max)` : stakingToken.symbol}\r\n      // stakingTokenDecimals={stakingToken.decimals}\r\n    />,\r\n  )\r\n\r\n  const [onPresentCompound] = useModal(\r\n    <CompoundModal earnings={earnings} onConfirm={onStake} tokenName={stakingToken.symbol} />,\r\n  )\r\n  const poolImage = `${pool.earningToken.symbol}-${pool.stakingToken.symbol}.png`.toLocaleLowerCase()\r\n  const [onPresentWithdraw] = useModal(\r\n    <WithdrawModal\r\n      max={stakedBalance}\r\n      onConfirm={onUnstake}\r\n      tokenName={stakingToken.symbol}\r\n      // stakingTokenDecimals={stakingToken.decimals}\r\n    />,\r\n  )\r\n\r\n  const handleApprove = useCallback(async () => {\r\n    try {\r\n      setRequestedApproval(true)\r\n      const txHash = await onApprove()\r\n      // user rejected tx or didn't go thru\r\n      if (!txHash) {\r\n        setRequestedApproval(false)\r\n      }\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n  }, [onApprove, setRequestedApproval])\r\n\r\n  return (\r\n    <Card isActive={isCardActive} isFinished={isFinished && sousId !== 0}>\r\n      {isFinished && sousId !== 0 && <PoolFinishedSash />}\r\n      <div style={{ padding: '24px' }}>\r\n        <CardTitle isFinished={isFinished && sousId !== 0}>\r\n          {isOldSyrup && '[OLD]'} {earningToken.symbol} {TranslateString(348, 'Pool')}\r\n        </CardTitle>\r\n        <div style={{ marginBottom: '8px', display: 'flex', alignItems: 'center' }}>\r\n          <div style={{ flex: 1 }}>\r\n            <Image\r\n              src={`https://raw.githubusercontent.com/octahedron22/smurf-frontend/master/public/images/pools/${poolImage}`}\r\n              alt={earningToken.symbol}\r\n              width={64}\r\n              height={64}\r\n            />\r\n          </div>\r\n          {account && harvest && !isOldSyrup && (\r\n            <HarvestButton\r\n              disabled={!earnings.toNumber() || pendingTx}\r\n              text={pendingTx ? 'Collecting' : 'Harvest'}\r\n              onClick={async () => {\r\n                setPendingTx(true)\r\n                await onReward()\r\n                setPendingTx(false)\r\n              }}\r\n            />\r\n          )}\r\n        </div>\r\n        {!isOldSyrup ? (\r\n          <BalanceAndCompound>\r\n            <Balance value={getBalanceNumber(earnings, earningToken.decimals)} isDisabled={isFinished} />\r\n            {sousId === 0 && account && harvest && (\r\n              <HarvestButton\r\n                disabled={!earnings.toNumber() || pendingTx}\r\n                text={pendingTx ? TranslateString(999, 'Compounding') : TranslateString(704, 'Compound')}\r\n                onClick={onPresentCompound}\r\n              />\r\n            )}\r\n          </BalanceAndCompound>\r\n        ) : (\r\n          <OldSyrupTitle hasBalance={accountHasStakedBalance} />\r\n        )}\r\n        <Label isFinished={isFinished && sousId !== 0} text={TranslateString(330, `${earningToken.symbol} earned`)} />\r\n        <StyledCardActions>\r\n          {!account && <UnlockButton />}\r\n          {account &&\r\n            (needsApproval && !isOldSyrup ? (\r\n              <div style={{ flex: 1 }}>\r\n                <Button disabled={isFinished || requestedApproval} onClick={handleApprove} width=\"100%\">\r\n                  {`Approve ${stakingToken.symbol}`}\r\n                </Button>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <Button\r\n                  disabled={stakedBalance.eq(new BigNumber(0)) || pendingTx}\r\n                  style={{ width: '80%' }}\r\n                  onClick={\r\n                    isOldSyrup\r\n                      ? async () => {\r\n                          setPendingTx(true)\r\n                          await onUnstake('0')\r\n                          setPendingTx(false)\r\n                        }\r\n                      : onPresentWithdraw\r\n                  }\r\n                >\r\n                  {`Unstake ${stakingToken.symbol}`}\r\n                </Button>\r\n                <StyledActionSpacer />\r\n                {!isOldSyrup && (\r\n                  <IconButton style={{ width: '20%' }} disabled={isFinished && sousId !== 0} onClick={onPresentDeposit}>\r\n                    <AddIcon color=\"white\" />\r\n                  </IconButton>\r\n                )}\r\n              </>\r\n            ))}\r\n        </StyledCardActions>\r\n        <StyledDetails>\r\n          <div>{TranslateString(736, 'APR')}:</div>\r\n          {isFinished || isOldSyrup || !apy ? (\r\n            '-'\r\n          ) : (\r\n            <Balance fontSize=\"14px\" isDisabled={isFinished} value={apy} decimals={2} unit=\"%\" />\r\n          )}\r\n        </StyledDetails>\r\n        <StyledDetails>\r\n          <div>{TranslateString(384, 'Your Stake')}:</div>\r\n          <Balance\r\n            fontSize=\"14px\"\r\n            isDisabled={isFinished}\r\n            value={getBalanceNumber(stakedBalance, stakingToken.decimals)}\r\n          />\r\n        </StyledDetails>\r\n      </div>\r\n      <CardFooter\r\n        projectLink={earningToken.projectLink}\r\n        decimals={stakingToken.decimals}\r\n        totalStaked={totalStaked}\r\n        startBlock={startBlock}\r\n        endBlock={endBlock}\r\n        isFinished={isFinished}\r\n        poolCategory={poolCategory}\r\n        tokenName={earningToken.symbol}\r\n        tokenAddress={earningToken.address ? getAddress(earningToken.address) : ''}\r\n        tokenDecimals={earningToken.decimals}\r\n      />\r\n    </Card>\r\n  )\r\n}\r\n\r\nconst PoolFinishedSash = styled.div`\r\n  background-image: url('https://raw.githubusercontent.com/octahedron22/smurf-frontend/master/public/images/pool-finished-sash.svg');\r\n  background-position: top right;\r\n  background-repeat: not-repeat;\r\n  height: 135px;\r\n  position: absolute;\r\n  right: -24px;\r\n  top: -24px;\r\n  width: 135px;\r\n`\r\n\r\nconst StyledCardActions = styled.div`\r\n  display: flex;\r\n  justify-content: center;\r\n  margin: 16px 0;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n`\r\n\r\nconst BalanceAndCompound = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  flex-direction: row;\r\n`\r\n\r\nconst StyledActionSpacer = styled.div`\r\n  height: ${(props) => props.theme.spacing[4]}px;\r\n  width: ${(props) => props.theme.spacing[4]}px;\r\n`\r\n\r\nconst StyledDetails = styled.div`\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  font-size: 14px;\r\n`\r\n\r\nexport default PoolCard\r\n"]},"metadata":{},"sourceType":"module"}